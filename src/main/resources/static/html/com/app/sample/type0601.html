<style>
    .type0601 #master {
        border: 1px solid var(--md-sys-color-outline-variant);
        min-height: 484px;
        border-radius: var(--njs-border-radius-l);
    }
</style>

<article class="type0601">
    <div class="flex-horizental">
        <div style="max-width: 218px;">
            <div class="flex-horizental">
                <div class="button-panel">
                    <button id="btnClose">-</button>
                    <button id="btnOpen">+</button>
                </div>
            </div>
            <div id="master"></div>
        </div>
        <div>
            <div class="button-panel">
                <button id="btnAdd">추가</button>
                <button id="btnDelete">삭제</button>
                <button id="btnSave">저장</button>
                <button id="btnExcel">엑셀</button>
            </div>
            <table id="detail" class="grid__">
                <colgroup>
                    <col style="width: 5%;">
                    <col style="width: 7%;">
                    <col style="width: 20%;">
                    <col style="width: auto;">
                    <col style="width: 11%;">
                    <col style="width: 11%;">
                    <col style="width: 5%;">
                    <col style="width: 12%;">
                    <col style="width: 7%;">
                    <col style="width: 0;">
                    <col style="width: 0;">
                </colgroup>
                <thead>
                    <tr>
                        <th><input id="checkAll" type="checkbox" title="Check all"></th>
                        <th>Index</th>
                        <th>Name</th>
                        <th>Email</th>
                        <th>Gender</th>
                        <th>Eye Color</th>
                        <th>Age</th>
                        <th>Registered</th>
                        <th>Active</th>
                        <th>About</th>
                        <th>Greeting</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td style="text-align: center;"><input class="checkAllTarget" type="checkbox"></td>
                        <td id="index" style="text-align: center;"></td>
                        <td><input id="name" type="text" data-validate='[["required"]]'></td>
                        <td><input id="email" type="text" data-validate='[["required"],["email"]]'></td>
                        <td style="text-align: center;"><select id="gender" data-validate='[["required"]]'>
                                <option>선택</option>
                        </select></td>
                        <td style="text-align: center;"><select id="eyeColor" data-validate='[["required"]]'>
                                <option>선택</option>
                        </select></td>
                        <td style="text-align: center;"><input id="age" type="text" data-validate='[["required"],["integer"]]'></td>
                        <td><input id="registered" type="text" data-format='[["date",8,"date"]]' data-validate='[["required"]]'></td>
                        <td style="text-align: center;"><input id="isActive" type="checkbox"></td>
                        <td><textarea id="about" style="min-width: 500px; min-height: 100px;"></textarea></td>
                        <td><textarea id="greeting"></textarea></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</article>

<script type="text/javascript">
(function() {

    var cont = N(".type0601").cont({
        "p.select.gender" : [ "gender" ],
        "p.select.eyeColor" : [ "eyeColor" ],
        "p.tree.master" : {
            key : "deptNm",
            val : "deptCd",
            parent : "pDeptCd",
            level : "deptLv",
            folderSelectable : true,
            onSelect : function(selNodeIndex, selNodeEle, selNodeData) {
                cont["c.getSampleList"]({
                    deptCd : selNodeData.deptCd
                }).submit(function(data) {
                    cont["p.grid.detail"].bind(data);
                });
            }
        },
        "p.grid.detail" : {
            "action" : [ "hide", [ 9, 10 ] ],
            height : 450,
            filter : false,
            checkAll : "#checkAll",
            checkAllTarget : ".checkAllTarget"
        },
        "c.getSampleDeptList" : function() {
            return N.comm("sample/getSampleDeptList.json");
        },
        "c.getSampleList" : function(params) {
            return N(params).comm("sample/getSampleList.json");
        },
        "c.saveSampleList" : function() {
            return N(cont["p.grid.detail"].data("modified")).comm({
                dataIsArray : true, // Array 타입의 여러 행데이터가 1 개 일때는 자동으로 Object로 변환됩니다. 자동으로 변환되지 않게 하려면 dataIsArray 옵션을 true로 지정해 주세요.
                url : "sample/saveSampleList.json"
            });
        },
        "e.btnOpen.click" : function(e) {
            e.preventDefault();
            cont["p.tree.master"].expand();
        },
        "e.btnClose.click" : function(e) {
            e.preventDefault();
            cont["p.tree.master"].collapse(true);
        },
        "e.btnExcel.click" : function(e) {
            e.preventDefault();

            cont["c.getSampleList"](cont["p.tree.master"].data("selected", "deptCd")).excelStreaming([ "샘플 목록", cont["p.grid.master"] ]);
        },
        "e.btnSave.click" : function(e) {
            e.preventDefault();

            return APP.comm.utils.save.call(this, {
                cont : cont,
                comm : "c.saveSampleList",
                changed : "p.grid.detail",
                validate : "p.grid.detail",
                after : function(data) {
                    cont["p.tree.master"].context(".tree_active__").click();
                }
            });
        },
        "e.btnAdd.click" : function(e) {
            e.preventDefault();
            cont["p.grid.detail"].add();
        },
        "e.btnDelete.click" : function(e) {
            e.preventDefault();

            return APP.comm.utils.del.call(this, {
                cont : cont,
                inst : "p.grid.detail"
            });
        },
        init : function(view, request) {
            cont["p.grid.detail"].bind();
            cont["c.getSampleDeptList"]().submit(function(data) {
                cont["p.tree.master"].bind(data);
            });
        }
    });

})();
</script>